{"version":3,"file":"ai_client.min.js","sources":["../src/ai_client.js"],"sourcesContent":["import Ajax from 'core/ajax';\nimport * as Options from './options';\n\nconst METHOD = 'tiny_acessibilia_generate_alt';\n\n// Converte um File em { mime, data } (data = base64 sem \"data:\")\nconst fileToBase64Parts = (file) => new Promise((resolve, reject) => {\n  const fr = new FileReader();\n  fr.onload = () => {\n    const s = String(fr.result || '');\n    const m = s.match(/^data:([^;]+);base64,(.*)$/);\n    if (!m) return reject(new Error('dataurl-parse-failed'));\n    resolve({ mime: m[1], data: m[2] });\n  };\n  fr.onerror = reject;\n  fr.readAsDataURL(file);\n});\n\n/**\n * Chama o webservice e retorna { alt: string }.\n * @param {TinyMCEEditor} editor\n * @param {File} file\n * @param {{prompt?: string}} [opts]\n * @returns {Promise<{alt: string}>}\n */\nexport const generateAlt = async (editor, file, opts = {}) => {\n  if (!file) throw new Error('no-file');\n\n  const { mime, data } = await fileToBase64Parts(file);\n\n  const args = {\n    prompt: opts.prompt ?? (Options.getPrompt(editor) || ''),\n    model:  Options.getModel(editor) || 'gemini-2.0-flash',\n    image:  { mime, data }, // <<< ESSENCIAL\n  };\n\n  // (Opcional) log temporário:\n  // console.log('[acessibilia] ws args', { mime, len: data.length });\n\n  // Devolvemos o próprio objeto do WS: { alt: '...' }.\n  return Ajax.call([{ methodname: METHOD, args }])[0];\n};\n\nexport default { generateAlt };\n"],"names":["METHOD","fileToBase64Parts","file","Promise","resolve","reject","fr","FileReader","onload","m","String","result","match","Error","mime","data","onerror","readAsDataURL","generateAlt","async","editor","opts","args","prompt","Options","getPrompt","model","getModel","image","Ajax","call","methodname"],"mappings":"ksCAGMA,OAAS,gCAGTC,kBAAqBC,MAAS,IAAIC,SAAQ,CAACC,QAASC,gBAClDC,GAAK,IAAIC,WACfD,GAAGE,OAAS,WAEJC,EADIC,OAAOJ,GAAGK,QAAU,IAClBC,MAAM,kCACbH,EAAG,OAAOJ,OAAO,IAAIQ,MAAM,yBAChCT,QAAQ,CAAEU,KAAML,EAAE,GAAIM,KAAMN,EAAE,MAEhCH,GAAGU,QAAUX,OACbC,GAAGW,cAAcf,SAUNgB,YAAcC,eAAOC,OAAQlB,2BAAMmB,4DAAO,OAChDnB,KAAM,MAAM,IAAIW,MAAM,iBAErBC,KAAEA,KAAFC,KAAQA,YAAed,kBAAkBC,MAEzCoB,KAAO,CACXC,4BAAQF,KAAKE,4CAAWC,QAAQC,UAAUL,SAAW,GACrDM,MAAQF,QAAQG,SAASP,SAAW,mBACpCQ,MAAQ,CAAEd,KAAAA,KAAMC,KAAAA,cAOXc,cAAKC,KAAK,CAAC,CAAEC,WAAY/B,OAAQsB,KAAAA,QAAS,kDAGpC,CAAEJ,YAAAA"}